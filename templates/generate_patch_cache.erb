#!/bin/sh
#
# Generate cache of patch data for consumption by Puppet custom facts.
#

PATH=/bin:/usr/bin:/sbin:/usr/sbin
export PATH
CACHEDIR=<%= @patch_data_cache_dir %>
YUMOPTS=" -C "
OS=`uname -s`

if [ ! -d ${CACHEDIR} ]; then
  mkdir -p ${CACHEDIR}
fi

case ${OS} in
  'Linux')
    /usr/bin/yum -q check-update 2>/dev/null > ${CACHEDIR}/cache.yum.cu
    echo $? > ${CACHEDIR}/cache.yum.cu.code
    /usr/bin/yum --security -q check-update 2>/dev/null > ${CACHEDIR}/cache.yum.scu
    echo $? > ${CACHEDIR}/cache.yum.scu.code
    /usr/bin/yum -q list-sec 2>/dev/null > ${CACHEDIR}/cache.yum.listsec
    echo $? > ${CACHEDIR}/cache.yum.listsec.code
  ;;
  *) ;;
esac

exit 0
